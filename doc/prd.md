
# 平台paas层

## 研发建模：适用于平台端进行领域、业务对象、页面的建模管理

## 流程引擎：适用于租户内部应用单据流程管理，包括业务流程、审批流程，支持租户管理员自定义流程

## 消息引擎：适用于平台与租户侧的消息通道管理，包括短信、邮件配置与发送记录运行

## 任务引擎：适用于平台与租户进行定时任务，预警任务的管理

## 日志引擎：适用于平台与租户进行操作日志、业务单据执行日志、接口事务日志进行

## 用户管理：适用于平台视角全平台用户管理

## 角色管理：使用与租户内部角色管理，角色可以添加资源

## 资源管理：适用与平台端定义saas应用、菜单、功能、页面资源

## 授权管理：适用于租户内部，从角色视角、用户视角进行功能授权、数据授权

## 统一鉴权管理：我希望参照RBAC模型，实现平台上不同身份的人登录、鉴权，根据身份、权限获取不同的资源；支持企业级SSO集成登录、支持三方Oauth集成登录，如钉钉、企微等

## 多组织管管理：适用于租户内部，实现组织业务隔离

# 平台端运营端

### 租户管理

- 支持多中租户类型，如
--  服务商（供应商伙伴）租户
--  科研（客户伙伴）租户
- 支持用户入职到不同租户

### 订阅管理

# 服务商端

## 客户管理

序号 模块 术语名称 术语描述
1 客户模块 客户分级 客户不同的等级分类：一种是各个子公司对自己的客户做标签分类，另一种是集团销售中心会基于医院级别和历史交易数据，计算对应权重分为ABC三个等级
2 客户模块 客户档案 整合客户全部的资料信息，包括客户的基本信息、销售和客户的互动信息、客户的合同信息、客户的业务数据、发票回款信息
5 客户模块 地址簿 根据不同的业务模式、业务类型、开票主体等设置不同的地址簿用作财务结算区分。地址簿字段：所属组织、档案编码、档案名称、专属业务员、信息用账期、管理区域、是否政府项目、是否现金备案、客户、专属部门
6 客户模块 签约单位 与公司签订合同的法人实体
7 客户模块 送检单位 发生检验外送订单的业务地点，用于收取样本
8 客户模块 对账单位 核算对账的业务对象
9 客户模块 开票单位 开具发票的抬头
10 客户模块 付款单位 支付结算款项的客户

## 项目管理

序号 模块 术语名称 术语描述
1 项目模块 分析项目 对内实验室维度，检验科室出报告结果的明细项目，为检测项目的更下一层级
2 项目模块 检测项目 对内实验室维度，实验室实际检测的项目，反应的是实验室的交付能力
3 项目模块 标准销售项目
（Lims：医嘱项目） 对外客户维度，由服务商的面向客户的标准销售项目，分为单/组/套/加等。
4 项目模块 个性化套餐 对外客户维度，服务商在标准销售项目基础上，变更组合方式或价格扣率的个性化服务项目，针对科研客户的特殊要求的标准销售项目的组合。
5 项目模块 总库 集团定义的项目库，项目名称唯一性，不增加额外前后缀，分为标准销售项目总库、检测项目总库，对应之前说的项目总库概念。
6 项目模块 分库 子公司定义的项目库，引用项目模板，基于设备/试剂、样本类型、时间点、体位等派生出差异化项目实例，分为标准销售项目总库、检测项目总库，对应之前说的项目分库概念。

## 价格管理

序号 模块 术语名称 术语描述
1 标准价格模块 标准物价 各子公司根据各地物价局的省区市三级标准物价、医院级别物价、医院等级物价设置的各检测项目的标准价格。
面向国家标准的检测项目，各子公司根据各地物价局的省区市三级标准物价、医院级别物价、医院等级物价设置的各检测项目的标准价格。
2 标准价格模块 省区市标准价 标准价格设置，各子公司可根据各地方物价局发布的标准物价，切分为省、市、县级标准价格.。
3 标准价格模块 医院级别标准价 标准价格设置，各子公司可根据各地方物价局发布的标准物价，根据各地方的医院级别和等级（三等十级）进行设置。
4 标准价格模块 医院等级标准价 标准价格设置，各子公司可根据各地方物价局发布的标准物价，根据各地方的医院级别和等级（三等十级）进行设置。
5 标准价格模块 物价代码 各地方物价局定义的物价代码。
6 标准价格模块 物价版本 根据获取最新的物价进行的版本设置。
7 标准价格模块 物价级别 各省市区级别、医院级别、医院等级。
8 标准价格模块 自主定价 没有标准物价，自定义的检测项目的标准价格，一般为集团和子公司两个级别的价格。
9 标准价格模块 集团指导价 面向所有检测项目；集团层面对检测项目设置的迪安指导价格，作为集团建议价格进行参考。集团制定下发至各子公司，指导管控各子公司的标准价格和自主定价。

### 价格体系：目前采用标准价格+扣率/个性化套餐组合定价，但价格联动管控机制与扣率折让管理优化

- 标准价格管理
- 客户合同价格管理
- 促销活动价格管理
- 特殊价格管理

|类别|具体内容|
| ---- | ---- |
|标准价格|标准物价：分区（省市县）标准价、医院级别标准价、医院等级标准价<br>自主定价（迪安）：集团价格、子公司价格<br>迪安指导价：集团指导价、子公司指导价|
|客户合同价格|标准项目价格：总扣率、分类扣率、单项目扣率、固定价格<br>阶梯价格：阶梯价格（订单量）、阶梯价格（结算额）<br>个性化服务项目价格：个性化套餐价格|
|促销活动价格|促销活动价格：促销价格策略<br>子公司促销价格 |
|特殊价格 - 前端渠道计价|前端渠道计价：|
|特殊价格 - 外包价格|外包价格：内部实验室定价、第三方实验室定价|
|说明|集团指导价作为集团层制定的价格，作为集团建议价格对各子公司价格进行管控，分析差异|

标准价格相关信息及关键属性：

|类别|具体内容|
| ---- | ---- |
|标准价格设置规则|各子公司可依据地方物价局发布标准物价，按省、市、县级划分标准价格；也能根据地方医院级别（一级、二级、三级 ）、等级（甲等、乙等、丙等…共十等 ）设置，且标准价格需联动更新地方最新标准物价|
|分区（省市县）标准价示例|省级：浙江省标准收费<br>市级：浙江省杭州市标准收费、茂名市标准收费<br>县级：潮州市县级标准收费|
|医院级别标准价示例|市一级：汕头市一级标准收费<br>市二级：汕头市二级标准收费<br>市三级：汕头市三级标准收费、潮州市三级标准收费|
|医院等级标准价示例|省二级甲等：广东省二甲收费<br>市三级甲等：广东省珠海市三甲收费<br>市二级甲等：广东省中山市二甲收费|
|标准价格关键属性 - 项目名称|标准检测项目对应物价书项目名称|
|标准价格关键属性 - 物价级别/等级|各省市区级别、医院级别、医院等级|
|标准价格关键属性 - 物价代码|各地方物价局定义的物价代码|
|标准价格关键属性 - 物价版本|根据获取最新物价进行的版本设置|
|标准价格关键属性 - 标准收费价格|相关标准价格|
|物价级别定义（示例）|物价级别：浙江省标准收费，所属子公司：杭州子公司<br>物价级别：上海市三甲标准收费，所属子公司：上海子公司<br>物价级别：广东省标准收费，所属子公司：广州子公司<br>物价级别：广东省二甲收费，所属子公司：广州子公司<br>物价级别：潮州市县级物价，所属子公司：广州子公司<br>物价级别：珠海市二甲收费，所属子公司：广州子公司|
|各地收费标准定义（示例，引用杭州物价级别 ）|项目名称：血红蛋白测定(Hb)，物价级别：浙江省标准收费，物价代码：250101001，物价版本：V1.0，标准收费价格：¥3.00，所属子公司：迪安诊断杭州子公司<br>项目名称：红细胞计数(RBC)，物价级别：浙江省标准收费，物价代码：250101002，物价版本：V1.0，标准收费价格：¥1.00，所属子公司：迪安诊断杭州子公司<br>项目名称：红细胞比积测定(HCT)，物价级别：浙江省标准收费，物价代码：250101003，物价版本：V1.0，标准收费价格：¥3.50，所属子公司：迪安诊断杭州子公司<br>项目名称：红细胞参数平均值测定，物价级别：浙江省标准收费，物价代码：250101004，物价版本：V1.0，标准收费价格：¥11.50，所属子公司：迪安诊断杭州子公司|
|各地收费标准定义（示例，引用上海物价级别 ）|项目名称：血红蛋白测定(Hb)，物价级别：上海市三甲标准收费，物价代码：250101001，物价版本：V1.1，标准收费价格：¥5.00，所属子公司：迪安诊断上海子公司<br>项目名称：红细胞计数(RBC)，物价级别：上海市三甲标准收费，物价代码：250101002，物价版本：V1.1，标准收费价格：¥6.00，所属子公司：迪安诊断上海子公司<br>项目名称：红细胞比积测定(HCT)，物价级别：上海市三甲标准收费，物价代码：250101003，物价版本：V1.1，标准收费价格：¥23.00，所属子公司：迪安诊断上海子公司<br>项目名称：红细胞参数平均值测定，物价级别：上海市三甲标准收费，物价代码：250101004，物价版本：V1.1，标准收费价格：¥12.00，所属子公司：迪安诊断上海子公司|

### 需求

建立物价联动机制：建立标准物价与省/市/区物价联动机制以及相应的数字化手段
制定物价管控流程：完善物价制定的机制和标准流程，明确不同项目在集团、子公司间的价格管理分工（指导价格/扣率）
制定合同价格管控流程：对于合同价格强化投标和签约价格的管控机制，保持报价与履约一致性；对于个性化套餐定价制定价格管控机制
制定促销价格管理：明确促销期间、促销区域、促销项目、促销客户，集团来统一制定总体促销价格策略和指导价标准，子公司按需进行调整。

## 合同管理

### 模块术语

序号 模块 术语名称 术语描述
1 合同模块 业务模式 分为检验外送、合作共建、精准中心三大业务模式，支持企业自定义
2 合同模块 业务类型 分为体检业务、常规业务、科研项目、两癌业务、公卫体检；其中公卫体检包含农民体检、老年体检
3 合同模块 无合同场景 指已约定好价格、履约、结算等合同条款信息，但未签回合同
3 合同模块 合同台账 用表格的方式将日常合同中的一些信息进行登记、编号，与合同归类存档相配合，方便日常的查找以及信息查询
4 合同模块 合同全生命周期 合同管理的全流程，包含合同初稿拟定、合同审核、合同签订盖章、合同录入归档、合同变更、合同履约、合同结算、合同分析
5 合同模块 合同类型 分为商务、技术、服务三种维度，包含医学检测服务协议、科研检测服务协议、医学检测服务补充协议、技术服务协议、维修服务协议、新冠核酸检测科研协议、医学检测服务终止协议、权利义务转让协议、委托检验服务协议、其他、办公室投放协议

### 合同字段

|类别|具体内容|
| ---- | ---- |
|客户|客户基础信息：包含客户名称、客户编号、客户地址<br>客户分类：内部客户、外部客户<br>客户层级：划分集团、医院、科室、医生不同的客户层级<br>业务逻辑角色：根据不同企业业务角色|
|商务|业务信息：包含业务所在区域和部门，及所负责的业务员、业务经理、区域经理等<br>业务模式：检验外送、合作共建、精准中心、渠道销售四大业务模式<br>业务类型：包含所有不同业务分类|
|履约|物流信息：包含取样周期及取样要求<br>检测要求：检测报告单交付要求及项目特殊检测要求|
|结算|结算方式：包含现金结算、票据转让和转账结算<br>结算周期：结算起止时间<br>回款周期：回款起止时间<br>开票要求：开票抬头及开票特殊要求|
|项目|项目编码：项目唯一代码<br>项目名称：项目名称<br>医嘱项目：检测项目组合或单项<br>个性化套餐项目：标准医嘱项目组合|
|价格|标准物价/指导价格/自主定价：提供标准收费基准<br>总扣率/分类扣率/单项目扣率：包含不同的扣率类型<br>固定价格/阶梯价格/个性化套餐价格：包含不同的价格类型|

### 合同价格管理

|体系类别|具体内容|
| ---- | ---- |
|价格体系 - 标准价格|标准物价：分区（省市县）标准价、医院级别标准价、医院等级标准价<br>自主定价（迪安）：集团价格、子公司价格|
|合同体系 - 物价相关|物价：物价级别、物价版本<br>自主定价|
|合同体系 - 扣率及价格类型|结算扣率：总扣率、分类扣率、单项目扣率<br>阶梯扣率：按订单量、按结算额<br>固定价格<br>个性化套餐价格|
|合同价格|标准项目价格<br>个性化服务项目价格|

# 客户端

## 项目查询

## 合同查询

## 报告查询

## 订单管理

## 支付管理

# 技术架构设计

## 系统架构

### 整体架构
- **微服务架构**：采用微服务架构模式，实现服务解耦和独立部署
- **分层架构**：表现层、业务层、数据访问层、基础设施层
- **云原生架构**：支持容器化部署，具备弹性伸缩能力

### 核心服务模块

#### PaaS平台服务
- **用户认证服务**：统一身份认证、SSO、OAuth集成
- **权限管理服务**：RBAC权限模型、资源授权
- **租户管理服务**：多租户隔离、组织管理
- **流程引擎服务**：工作流定义、执行、监控
- **消息引擎服务**：消息队列、通知推送
- **任务调度服务**：定时任务、异步任务处理
- **日志审计服务**：操作日志、业务日志、系统日志

#### 业务服务
- **客户管理服务**：客户档案、分级管理
- **项目管理服务**：项目库管理、项目配置
- **价格管理服务**：价格体系、扣率管理
- **合同管理服务**：合同全生命周期管理
- **订单管理服务**：订单处理、状态跟踪
- **支付管理服务**：支付集成、账单管理
- **报告管理服务**：报告生成、查询展示

## 技术选型

### 后端技术栈
- **开发语言**：Java 21 / Spring Boot 3.5.x
- **微服务框架**：Spring Cloud Alibaba
- **API网关**：Spring Cloud Gateway
- **服务注册发现**：Nacos
- **配置中心**：Nacos Config
- **负载均衡**：Ribbon / Spring Cloud LoadBalancer
- **熔断器**：Sentinel
- **分布式事务**：Seata

### 数据存储
- **关系型数据库**：MySQL 8.0（主数据存储）
- **缓存数据库**：Redis 7.x（缓存、会话存储）
- **搜索引擎**：Elasticsearch 8.x（日志检索、全文搜索）
- **消息队列**：RocketMQ / Apache Kafka
- **文件存储**：MinIO / 阿里云OSS

### 前端技术栈
- **框架**：Vue 3.x + TypeScript
- **UI组件库**：Element Plus / Ant Design Vue
- **状态管理**：Pinia
- **路由管理**：Vue Router 4.x
- **构建工具**：Vite
- **HTTP客户端**：Axios

### 基础设施
- **容器化**：Docker + Kubernetes
- **CI/CD**：Jenkins / GitLab CI
- **监控告警**：Prometheus + Grafana
- **链路追踪**：SkyWalking / Jaeger
- **日志收集**：ELK Stack (Elasticsearch + Logstash + Kibana)

## 数据库设计

### 核心数据表设计

#### 用户权限相关
- **sys_user**：用户基础信息表
- **sys_role**：角色定义表
- **sys_permission**：权限资源表
- **sys_user_role**：用户角色关联表
- **sys_role_permission**：角色权限关联表
- **sys_tenant**：租户信息表
- **sys_organization**：组织架构表

#### 业务核心表
- **customer_info**：客户基础信息表
- **customer_address**：客户地址簿表
- **project_master**：项目主数据表
- **project_price**：项目价格表
- **contract_info**：合同信息表
- **contract_item**：合同明细表
- **order_info**：订单主表
- **order_item**：订单明细表
- **report_info**：报告信息表

### 数据库分库分表策略
- **垂直分库**：按业务模块分离数据库
- **水平分表**：大数据量表按租户ID或时间分表
- **读写分离**：主从复制，读写分离提升性能

## 安全设计

### 认证授权
- **JWT Token**：无状态认证机制
- **OAuth 2.0**：第三方登录集成
- **RBAC模型**：基于角色的访问控制
- **多因子认证**：支持短信、邮箱验证码

### 数据安全
- **数据加密**：敏感数据AES加密存储
- **传输加密**：HTTPS/TLS加密传输
- **SQL注入防护**：参数化查询、输入验证
- **XSS防护**：输出编码、CSP策略

### 审计日志
- **操作审计**：用户操作行为记录
- **数据变更审计**：关键数据变更追踪
- **登录审计**：登录行为安全监控

# 开发计划

## 项目里程碑

### 第一阶段：基础平台搭建（4周）
**目标**：完成基础架构和核心服务框架

**主要任务**：
- 微服务架构搭建
- 基础设施环境准备
- 用户认证授权服务开发
- 租户管理服务开发
- 基础数据模型设计

**交付物**：
- 微服务基础框架
- 用户登录注册功能
- 租户管理后台
- 基础权限控制

### 第二阶段：核心业务模块（6周）
**目标**：实现主要业务功能模块

**主要任务**：
- 客户管理模块开发
- 项目管理模块开发
- 价格管理模块开发
- 合同管理模块开发
- 前端页面开发

**交付物**：
- 客户档案管理系统
- 项目库管理系统
- 价格体系管理系统
- 合同全生命周期管理

### 第三阶段：业务流程优化（4周）
**目标**：完善业务流程和用户体验

**主要任务**：
- 订单管理模块开发
- 报告管理模块开发
- 支付管理模块开发
- 流程引擎集成
- 消息通知功能

**交付物**：
- 订单处理系统
- 报告查询系统
- 支付结算系统
- 业务流程自动化

### 第四阶段：系统集成测试（3周）
**目标**：系统集成和全面测试

**主要任务**：
- 系统集成测试
- 性能压力测试
- 安全渗透测试
- 用户验收测试
- 部署上线准备

**交付物**：
- 测试报告
- 性能优化方案
- 安全加固措施
- 上线部署方案

## 团队分工

### 后端开发团队（4人）
- **架构师**：系统架构设计、技术选型
- **高级开发工程师**：核心业务模块开发
- **开发工程师**：业务功能实现
- **测试工程师**：单元测试、集成测试

### 前端开发团队（2人）
- **前端架构师**：前端架构设计、组件库搭建
- **前端开发工程师**：页面开发、交互实现

### 运维团队（1人）
- **DevOps工程师**：基础设施搭建、CI/CD流水线

### 产品团队（2人）
- **产品经理**：需求分析、产品设计
- **UI/UX设计师**：界面设计、用户体验优化

## 风险控制

### 技术风险
- **性能风险**：大并发场景下的系统性能
  - 缓解措施：性能测试、缓存优化、数据库优化
- **安全风险**：数据泄露、系统攻击
  - 缓解措施：安全审计、渗透测试、安全培训
- **集成风险**：第三方系统集成复杂度
  - 缓解措施：接口标准化、集成测试、降级方案

### 项目风险
- **进度风险**：开发进度延期
  - 缓解措施：敏捷开发、每日站会、里程碑检查
- **质量风险**：软件质量不达标
  - 缓解措施：代码审查、自动化测试、质量门禁
- **人员风险**：关键人员离职
  - 缓解措施：知识文档化、技能交叉培训

## 质量保证

### 代码质量
- **代码规范**：统一编码规范和代码风格
- **代码审查**：强制代码审查流程
- **静态分析**：SonarQube代码质量检查
- **单元测试**：代码覆盖率不低于80%

### 测试策略
- **单元测试**：开发人员编写，覆盖核心业务逻辑
- **集成测试**：验证服务间接口和数据流
- **系统测试**：端到端业务流程测试
- **性能测试**：并发用户、响应时间、吞吐量测试
- **安全测试**：漏洞扫描、渗透测试

### 部署策略
- **蓝绿部署**：零停机时间部署
- **灰度发布**：逐步放量，降低发布风险
- **回滚机制**：快速回滚到稳定版本
- **监控告警**：实时监控系统状态和业务指标

# 运维监控

## 监控体系

### 基础监控
- **服务器监控**：CPU、内存、磁盘、网络
- **应用监控**：JVM性能、接口响应时间、错误率
- **数据库监控**：连接数、慢查询、锁等待
- **中间件监控**：Redis、MQ、Elasticsearch状态

### 业务监控
- **用户行为监控**：登录量、活跃用户、功能使用率
- **业务指标监控**：订单量、成功率、收入指标
- **异常监控**：业务异常、系统异常、安全异常

### 告警机制
- **分级告警**：紧急、重要、一般三个级别
- **多渠道通知**：短信、邮件、钉钉、企微
- **告警收敛**：避免告警风暴，智能降噪
- **自动恢复**：部分故障自动修复机制

## 运维自动化

### 部署自动化
- **CI/CD流水线**：代码提交到生产部署全自动化
- **环境管理**：开发、测试、预生产、生产环境
- **配置管理**：统一配置中心，环境隔离

### 运维自动化
- **自动扩缩容**：基于负载自动调整实例数量
- **故障自愈**：常见故障自动检测和修复
- **备份恢复**：数据自动备份和恢复验证

# 总结

本PRD文档详细描述了生物技术平台的产品需求、技术架构和实施计划。通过微服务架构和云原生技术，构建一个高可用、高性能、安全可靠的SaaS平台，支持多租户、多组织的复杂业务场景。

项目采用敏捷开发模式，分四个阶段实施，预计17周完成。通过完善的质量保证体系和风险控制措施，确保项目按时高质量交付。
